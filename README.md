# Домашнее задание №1 (pro)

## Постановка задачи

В данном задании нам необходимо было обучить модель регрессии для предсказания стоимости автомобилей.

### Состав датасета:

| Признак           | Описание                                    |
|-------------------|---------------------------------------------|
| Name              | Имя автомобиля                               |
| Year              | Год выпуска                                  |
| Km_driven         | Пробег                                       |
| Fuel              | Тип топлива                                  |
| Seller_type       | Тип продавца                                 |
| Transmission      | Тип трансмиссии                              |
| Owner Type        | Тип хозяина (первый владелец, второй, и т.д.)|
| Mileage           | Расход топлива                               |
| Engine            | Объем двигателя                              |
| Max_power         | Мощность двигателя                           |
| Torque            | Максимальный крутящий момент                 |

Конечная цель работы заключается в деплое модели в приложение **Streamlit**.

---

## Часть 1 – EDA (Разведочный анализ данных)

В первой части работы были проведены следующие шаги:

1. Проведен быстрый разведочный анализ с использованием библиотеки `ydata_profiling`.
2. Удалены дублирующиеся записи.
3. Парсинг данных о максимальном крутящем моменте и оборотах, при которых он достигается.
4. Приведены типы данных к единому формату, удалены единицы измерений там, где это необходимо.
5. Пропуски заполнены значениями медианы.
6. Рассчитаны корреляции Пирсона, Спирмена и phik.
7. Построены графики распределений и проведен анализ статистик переменных.

### Выводы:
- Определено, какие переменные хорошо коррелируют с целевой переменной как линейно, так и нелинейно.
- Установлено, что распределения переменных имеют смещение и не соответствуют нормальному закону.
- Сделана гипотеза о необходимости логарифмирования целевой переменной.

---

## Часть 2 – Линейная регрессия на вещественных признаках

Здесь была обучена обычная модель линейной регрессии, затем применена стандартизация признаков и введены методы регуляризации типа Lasso и L0.

Итогом стало достижение значения R2 = 0.60 у модели с Lasso-регуляризацией с подобранными гиперпараметрами.

### Коэффициенты модели:

| Индекс   | Переменная          | Значение               |
|----------|---------------------|------------------------|
| 0        | max_power           | 325597.702500          |
| 1        | year                | 166293.634827          |
| 2        | engine              | 12568.623926           |
| 3        | torque              | 10040.980512           |
| 4        | mileage             | -11849.150273          |
| 5        | seats               | -31081.514015          |
| 6        | km_driven           | -50120.169475          |
| 7        | max_torque_rpm      | -66608.924359          |

Модель Lasso не занулила ни одного коэффициента.

---

## Часть 3 – Категориальные признаки

Категоричные переменные были обработаны следующим образом:

- Разделение переменной `Name` на компоненты (`Brand`, `Model`, `Variant`).
- Кодировка категориальных признаков методом One-Hot Encoding (OHE).

Выводы:
1. OHE не рекомендуется применять к порядковым признакам, однако полезно для номинальных типов («КПП», «типы владельцев», «топливо»).
2. Необходимо обучать OHE-кодировщик исключительно на тренировочном наборе данных, применяя полученный объект как на обучении, так и на тестировании.
3. Высококардинальные признаки (например, бренды, модели и комплектации) требуют особого подхода при кодировке.

### Результаты:
Обучение модели Ridge привело к улучшению качества с R2 = 0.60 до R2 = 0.95$, хотя кросс-валидационная оценка показала сильное переобучение (CV = 0.81).

---

## Часть 4 – Инженерия признаков (Feature Engineering)

Основные изменения включали:

1. Логарифмирование целевого признака.
2. Создание новых признаков:
   - Возраст автомобиля.
   - Флаг премиальности/бюджетности марки.
   - Степень эксплуатации (возраст × пробег).
   - Соотношение крутящего момента и мощности, пробега и года выпуска, удельного расхода топлива.
3. Использование полиномиальных признаков на основе численных значений.
4. Стандаризация числовых признаков.
5. Применение LeaveOneOutEncoder для высококардинальных признаков.
6. Применение OneHotEncoder для низкокардинальных признаков.


### Итог:
После подбора гиперпараметров получилось достичь показателя R2 = 0.807.

---

## Часть 5 – Бизнес-метрики

Реализована специфическая бизнесовая метрика: доля прогнозируемых цен, отклоняющихся от реальной цены менее чем на 10%. Лучший показатель составил 0.399.
Также создана кастомная асимметричная MAE-метрика, штрафующая недопрогноз вдвое сильнее, чем перепрогноз. Оптимальное значение достигнуто на уровне 189724.

---

## Часть 6 – Оформление и деплой

Создан пайплайн обработки данных, включая:

- Трансформацию исходных данных.
- Генерацию графиков для визуализации.
- Предсказание цен на автомобили.

Результатом стало **Streamlit-приложение**, способное отображать графики обучающих данных и выдавать прогнозы как для целого набора автомобилей, так и для конкретного экземпляра с вводом данных пользователем.
Ссылка на приложение: https://mltask1-qgdabsb65hupfbtseeby8h.streamlit.app/

---

## Итоговый вывод

Проведен полноценный цикл анализа данных, обучение моделей регрессии и создание готового решения в приложении Streamlit. Наибольшее улучшение метрик получено благодаря реализации инженерии признаков, обеспечившей повышение точности до R2 = 0.91.
